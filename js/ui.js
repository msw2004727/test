// ui.js - ‰ΩøÁî®ËÄÖ‰ªãÈù¢Ëàá DOM Êìç‰ΩúÊ®°ÁµÑ

/**
 * ÂÅΩÂ∞éÂÖ• - Âú®‰∏ÄÂÄãÁúüÊ≠£ÁöÑÊ®°ÁµÑÂåñÁ≥ªÁµ±‰∏≠ÔºåÊÇ®ÊúÉÂÉèÈÄôÊ®£Â∞éÂÖ•Ôºö
 * import * as GameState from './game-state.js'; // ÈÅäÊà≤ÁãÄÊÖãÂíå DOM ÂÖÉÁ¥†ÂºïÁî®
 * // import * as GameLogic from './game-logic.js'; // Â¶ÇÊûú UI Êìç‰ΩúÈúÄË¶ÅËß∏ÁôºÈÅäÊà≤ÈÇèËºØ
 * // import * as ApiClient from './api-client.js'; // Â¶ÇÊûú UI Êìç‰ΩúÁõ¥Êé•Ëß∏Áôº API
 */

// --- DOM ÂÖÉÁ¥†Áç≤Âèñ (ÁêÜÊÉ≥ÊÉÖÊ≥Å‰∏ãÁî± GameState ÊàñÂ∞àÈñÄÁöÑ elements.js ÁÆ°ÁêÜ) ---
// ÁÇ∫‰∫ÜÁ∞°ÂåñÔºåÈÄôË£°ÂÅáË®≠ GameState.elements ÂåÖÂê´ÊâÄÊúâÈúÄË¶ÅÁöÑ DOM ÂºïÁî®
// ‰æãÂ¶Ç: GameState.elements.feedbackModal, GameState.elements.monsterImageElement Á≠â

// --- ÈÄöÁî® UI ËºîÂä©ÂáΩÂºè ---

export function openModal(modalId) {
    const modal = document.getElementById(modalId); // GameState.elements[modalId]
    if (modal) {
        modal.style.display = 'flex';
        console.log(`UI: Modal ${modalId} opened.`);
    } else {
        console.warn(`UI: Modal with id ${modalId} not found.`);
    }
}

export function closeModal(modalId) {
    const modal = document.getElementById(modalId); // GameState.elements[modalId]
    if (modal) {
        modal.style.display = 'none';
        console.log(`UI: Modal ${modalId} closed.`);
    } else {
        console.warn(`UI: Modal with id ${modalId} not found.`);
    }
}

export function closeAllModals() {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modalElement => {
        if (modalElement && modalElement.id) {
            closeModal(modalElement.id);
        }
    });
    console.log("UI: All modals closed.");
}

export function showFeedbackModal(title, messageOrContent, showSpinner, showCloseXButton = true, showMonsterDetails = false, monsterForDetails = null) {
    const { feedbackModal, feedbackModalTitle, feedbackModalSpinner, feedbackModalCloseX, feedbackMonsterDetailsDiv, feedbackModalMessage } = GameState.elements; // ÂÅáË®≠ÂÖÉÁ¥†Âú® GameState ‰∏≠

    if (!feedbackModalTitle || !feedbackModalSpinner || !feedbackModalCloseX || !feedbackMonsterDetailsDiv || !feedbackModalMessage) {
        console.error("UI: Feedback modal elements not found in GameState.elements.");
        return;
    }

    feedbackModalTitle.textContent = title;
    feedbackModalSpinner.style.display = showSpinner ? 'block' : 'none';
    feedbackModalCloseX.style.display = showCloseXButton ? 'block' : 'none';

    feedbackMonsterDetailsDiv.innerHTML = '';
    if (showMonsterDetails && monsterForDetails) {
        feedbackModalMessage.innerHTML = ""; // Ê∏ÖÁ©∫‰∏ÄËà¨Ë®äÊÅØ
        feedbackMonsterDetailsDiv.style.display = 'block';
        // ... (Âæû index.html Ë§áË£Ω‰∏¶Ë™øÊï¥Ê∏≤Êüì monsterForDetails ÁöÑ HTML ÁµêÊßãÁöÑÁ®ãÂºèÁ¢º)
        // ‰æãÂ¶Ç:
        // const personalityObj = monsterForDetails.personality || {name: "Êú™Áü•", text: "ÂÄãÊÄßË≥áÊñô‰∏çÂÆåÊï¥", color: "var(--text-secondary)"};
        // let elementCompHTML = monsterForDetails.elementComposition ? Object.entries(monsterForDetails.elementComposition)
        //     .map(([el, pc]) => `<span style="color:${getElementStyling(el).text}; font-weight:bold;">${el} ${pc}%</span>`)
        //     .join(', ') : "ÁÑ°";
        // feedbackMonsterDetailsDiv.innerHTML = `<h4>${monsterForDetails.nickname}</h4><p>Â±¨ÊÄß: ${elementCompHTML}</p>...`;
        console.log("UI: Feedback modal showing monster details for", monsterForDetails.nickname);
    } else {
        feedbackMonsterDetailsDiv.style.display = 'none';
        feedbackModalMessage.innerHTML = typeof messageOrContent === 'string' ? messageOrContent.replace(/\n/g, '<br>') : '';
        if (typeof messageOrContent !== 'string' && messageOrContent instanceof HTMLElement) {
             feedbackModalMessage.innerHTML = ''; // Clear previous messages
             feedbackModalMessage.appendChild(messageOrContent);
        }
    }
    openModal('feedback-modal');
}

export function applyTheme(theme) {
    const { themeIcon } = GameState.elements; // ÂÅáË®≠ÂÖÉÁ¥†Âú® GameState ‰∏≠
    if (theme === 'light') {
        document.body.classList.add('light-theme');
        if (themeIcon) themeIcon.textContent = '‚òÄÔ∏è';
    } else {
        document.body.classList.remove('light-theme');
        if (themeIcon) themeIcon.textContent = 'üåô';
    }
    localStorage.setItem('theme', theme);
    // updateMonsterSnapshotDisplay(GameState.currentMonster); // Á¢∫‰øùÂú® GameState ÂèØÁî®ÂæåÂëºÂè´
    // populateInventory();
    // populateTemporaryBackpack();
    console.log(`UI: Theme applied - ${theme}. Snapshot and inventories might need refresh.`);
}

export function getContrastColor(hexColor) {
    const currentThemeIsLight = document.body.classList.contains('light-theme');
    if (!hexColor) {
        return currentThemeIsLight ? 'var(--text-primary-light)' : 'var(--text-primary-dark)';
    }
    // ... (ÂÆåÊï¥ÁöÑ getContrastColor ÈÇèËºØÂæû index.html Ë§áË£ΩÈÅé‰æÜ) ...
    let R, G, B;
    hexColor = hexColor.replace("#", "");
    if (hexColor.length === 3) { /* ... */ } else if (hexColor.length === 6) { /* ... */ } else { return currentThemeIsLight ? 'var(--text-primary-light)' : 'var(--text-primary-dark)'; }
    const yiq = (R * 299 + G * 587 + B * 114) / 1000;
    return yiq >= 128 ? (currentThemeIsLight ? '#000000' : '#FFFFFF' ): (currentThemeIsLight ? '#FFFFFF' : '#000000');
}

export function getElementStyling(elementType) {
    if (!elementType) elementType = 'ÁÑ°';
    const typeKey = elementType.toLowerCase();
    // ... (ÂÆåÊï¥ÁöÑ getElementStyling ÈÇèËºØÂæû index.html Ë§áË£ΩÈÅé‰æÜ) ...
    // ËøîÂõû { text: 'var(...)', bg: 'var(...)' }
    // ÁØÑ‰æã:
    switch(typeKey) {
        case 'ÁÅ´': return { text: 'var(--element-fire-text)', bg: 'var(--element-fire-bg)' };
        // ... ÂÖ∂‰ªñÂÖÉÁ¥†
        default: return { text: 'var(--element-mix-text)', bg: 'var(--element-mix-bg)' };
    }
}

export function getRarityStyling(rarityName) {
    // ... (ÂÆåÊï¥ÁöÑ getRarityStyling ÈÇèËºØÂæû index.html Ë§áË£ΩÈÅé‰æÜ, ÂèØËÉΩ‰æùË≥¥ getRarityData) ...
    // const rarityData = GameLogic.getRarityData(rarityName); // ÂÅáË®≠ getRarityData Âú® game-logic.js
    // return { text: `var(${rarityData.textVarKey || '--rarity-common-text'})` };
    // Á∞°ÂåñÁâà:
    switch(rarityName) {
        case "Á®ÄÊúâ": return { text: 'var(--rarity-rare-text)'};
        // ... ÂÖ∂‰ªñÁ®ÄÊúâÂ∫¶
        default: return { text: 'var(--rarity-common-text)'};
    }
}


// --- È†ÅÁ±§ÊéßÂà∂ ---
export function openGenericTab(evt, tabName, modalOrTabContainerId) {
    // ... (ÂÆåÊï¥ÁöÑ openGenericTab ÈÇèËºØÂæû index.html Ë§áË£ΩÈÅé‰æÜ) ...
    console.log(`UI: Opening generic tab ${tabName} in ${modalOrTabContainerId}`);
}

export function openDnaFarmTab(evt, tabName) {
    // ... (ÂÆåÊï¥ÁöÑ openDnaFarmTab ÈÇèËºØÂæû index.html Ë§áË£ΩÈÅé‰æÜ) ...
    console.log(`UI: Opening DNA/Farm tab ${tabName}`);
}

// --- Â∫´Â≠òËàá DNA È°ØÁ§∫ ---
export function createDnaElement(item, index, sourceType) {
    // ... (ÂÆåÊï¥ÁöÑ createDnaElement ÈÇèËºØÂæû index.html Ë§áË£ΩÈÅé‰æÜ) ...
    // ÈÄôÂÄãÂáΩÂºèÊúÉÂâµÂª∫‰∏¶ËøîÂõû‰∏ÄÂÄã div ÂÖÉÁ¥†
    // Ê≥®ÊÑèÔºöÂÆÉÂÖßÈÉ®ÂèØËÉΩÊúÉÁ∂ÅÂÆö‰∫ã‰ª∂Áõ£ËÅΩÂô®ÔºåÈÄô‰∫õÁõ£ËÅΩÂô®ÊáâÂëºÂè´ game-logic.js ‰∏≠ÁöÑÂáΩÂºè
    // ‰æãÂ¶Ç: slotDiv.addEventListener('dragstart', GameLogic.handleDragStart);
    // ‰æãÂ¶Ç: if (sourceType === 'temporary' && item) {
    //          slotDiv.onclick = () => GameLogic.moveFromTempToInventoryLogic(index);
    //       }
    const sD = document.createElement('div');
    sD.textContent = item ? item.name : 'Á©∫‰Ωç';
    // Êõ¥Â§öÊ®£ÂºèÂíåÂ±¨ÊÄßË®≠ÂÆö...
    console.log(`UI: Creating DNA element for ${sourceType} slot ${index}`);
    return sD;
}

export function populateInventory() {
    const { inventoryItemsContainer } = GameState.elements;
    if (!inventoryItemsContainer) { console.error("UI: inventoryItemsContainer not found!"); return; }
    inventoryItemsContainer.innerHTML = '';

    for (let i = 0; i < GameState.NUM_INVENTORY_SLOTS; i++) {
        const item = GameState.inventoryDisplaySlots[i];
        const slotDiv = createDnaElement(item, i, 'inventory');
        // slotDiv.addEventListener('dragstart', GameLogic.handleDragStart); // Á∂ÅÂÆöÊãñÊõ≥ÈñãÂßã
        // slotDiv.addEventListener('drop', GameLogic.handleDrop); // Á∂ÅÂÆöÊîæÁΩÆ
        // ... ÂÖ∂‰ªñ‰∫ã‰ª∂
        inventoryItemsContainer.appendChild(slotDiv);
    }
    // Ê∑ªÂä† "ÊäΩDNA" ÊåâÈàïÂíå "Âà™Èô§ÂçÄ"
    // const drawDnaBtnElement = ... create ...
    // drawDnaBtnElement.addEventListener('click', GameLogic.handleDrawDnaButtonClickLogic);
    // inventoryItemsContainer.appendChild(drawDnaBtnElement);
    // const deleteSlotDiv = ... create ...
    // deleteSlotDiv.addEventListener('dragover', GameLogic.handleDragOver);
    // deleteSlotDiv.addEventListener('drop', GameLogic.handleDropOnDeleteSlotLogic);
    // inventoryItemsContainer.appendChild(deleteSlotDiv);
    console.log("UI: Inventory populated.");
}

export function populateTemporaryBackpack() {
    // ... (È°û‰ºº populateInventory ÁöÑÈÇèËºØÔºåÈÅçÊ≠∑ GameState.temporaryBackpackSlots) ...
    console.log("UI: Temporary backpack populated.");
}

export function updateCombinationSlotUI(comboSlotId, dnaItem) {
    // ... (Êõ¥Êñ∞ÊåáÂÆöÁµÑÂêàÊßΩÁöÑ UIÔºåÈ°ØÁ§∫ DNA ÂêçÁ®±„ÄÅÊ®£ÂºèÁ≠â) ...
    console.log(`UI: Combination slot ${comboSlotId} UI updated.`);
}

export function clearCombinationSlotUI(comboSlotId) {
    // ... (Ê∏ÖÈô§ÊåáÂÆöÁµÑÂêàÊßΩÁöÑ UIÔºåÊÅ¢Âæ©ÁÇ∫È†êË®≠ÊñáÂ≠óÂíåÊ®£Âºè) ...
    console.log(`UI: Combination slot ${comboSlotId} UI cleared.`);
}

export function createCombinationSlots() {
    // ... (ÂâµÂª∫ÂàùÂßãÁöÑ DNA ÁµÑÂêàÊßΩ UI) ...
    // GameState.elements.dnaCombinationSlotsContainer.innerHTML = '';
    // for (let i = 0; i < GameState.NUM_COMBINATION_SLOTS; i++) { /* ... create slot ... */ }
    console.log("UI: Combination slots created.");
}

// --- ÊÄ™Áç∏Áõ∏Èóú UI ---
export function updateMonsterSnapshotDisplay(monster) {
    const { monsterImageElement, snapshotAchievementTitle, snapshotNickname, snapshotWinLoss, snapshotEvaluation, monsterInfoButton } = GameState.elements;
    // ... (ÂÆåÊï¥ÁöÑ updateMonsterSnapshotDisplay ÈÇèËºØÂæû index.html Ë§áË£ΩÈÅé‰æÜ) ...
    // ÊúÉÊõ¥Êñ∞ÂúñÁâá„ÄÅÊö±Á®±„ÄÅË©ïÂÉπÁ≠â
    console.log("UI: Monster snapshot updated for", monster ? monster.nickname : "no monster");
}

export function renderMonsterInfoModalContent(monster) { // Êñ∞Â¢ûÁöÑÂáΩÂºèÔºåÂ∞àÈñÄËôïÁêÜÊ∏≤ÊüìÂÖßÂÆπ
    const { monsterInfoModalHeaderContent, monsterDetailsTab, monsterActivityLogsContainer } = GameState.elements;
    if (!monsterInfoModalHeaderContent || !monsterDetailsTab || !monsterActivityLogsContainer) return;
    if (!monster) { /* ... ËôïÁêÜÁÑ°ÊÄ™Áç∏ÊÉÖÊ≥Å ... */ return; }

    // ... (Âæû index.html ÁöÑ updateMonsterInfoModal Ë§áË£ΩÂ§ßÈÉ®ÂàÜÊ∏≤Êüì HTML ÁöÑÈÇèËºØÂà∞ÈÄôË£°) ...
    // ‰æãÂ¶Ç: monsterInfoModalHeaderContent.innerHTML = `<div class="monster-info-name-styled">${monster.nickname}</div>`;
    // monsterDetailsTab.innerHTML = `...`;
    // updateMonsterActivityLog(monster); // ÈÄôÂÄã‰πüÊáâË©≤ÊòØ UI ÂáΩÂºè
    console.log(`UI: Rendering monster info modal content for ${monster.nickname}`);
}

export function updateMonsterInfoModal(monster) { // ÈÄôÂÄãÂáΩÂºèÁèæÂú®‰∏ªË¶ÅÂçîË™øÔºå‰∏¶ËôïÁêÜ AI ÊèèËø∞ÁöÑÈÇèËºØ
    if (!monster) {
        renderMonsterInfoModalContent(null); // ÂëºÂè´Ê∏≤ÊüìÂáΩÂºèËôïÁêÜÁ©∫ÁãÄÊÖã
        // UI.openGenericTab(null, 'monster-details-tab', 'monster-info-modal'); // Á¢∫‰øùÈ°ØÁ§∫È†êË®≠È†ÅÁ±§
        return;
    }

    if (!monster.aiPersonality || !monster.aiIntroduction || !monster.aiEvaluation) {
        renderMonsterInfoModalContent(monster); // ÂÖàÊ∏≤ÊüìÂü∫Êú¨Ë≥áË®ä
        // GameLogic.generateAndStoreAIDescriptionsLogic(monster).then(updatedMonster => { // Âæû game-logic.js ÂëºÂè´
        //     const currentModalMonsterName = GameState.elements.monsterInfoModalHeaderContent?.querySelector('.monster-info-name-styled')?.textContent;
        //     if (document.getElementById('monster-info-modal').style.display === 'flex' && currentModalMonsterName === updatedMonster.nickname) {
        //         renderMonsterInfoModalContent(updatedMonster); // AI ÊèèËø∞Âõû‰æÜÂæåÂÜçÊ¨°Ê∏≤Êüì
        //     }
        // });
        console.log(`UI: Monster info for ${monster.nickname} displayed, AI description pending/being fetched by game-logic.`);
    } else {
        renderMonsterInfoModalContent(monster); // Áõ¥Êé•Ê∏≤ÊüìÂÆåÊï¥Ë≥áË®ä
    }
    // UI.openGenericTab(null, 'monster-details-tab', 'monster-info-modal'); // Á¢∫‰øùÈ°ØÁ§∫È†êË®≠È†ÅÁ±§
}


export function updateMonsterActivityLog(monster) {
    // ... (Êõ¥Êñ∞ÊÄ™Áç∏Ê¥ªÂãïÊó•Ë™åÁöÑ UI) ...
    console.log(`UI: Monster activity log updated for ${monster.nickname}.`);
}


// --- Ëæ≤Â†¥ UI ---
export function populateFarmList() {
    // ... (ÈÅçÊ≠∑ GameState.farmedMonstersÔºåÁÇ∫ÊØèÂÄãÊÄ™Áç∏ÂâµÂª∫ÂàóË°®È†Ö‰∏¶Ê∑ªÂä†Âà∞ DOM) ...
    // ÊØèÂÄãÂàóË°®È†ÖÁöÑÊåâÈàï‰∫ã‰ª∂Áõ£ËÅΩÂô®ÊáâÂëºÂè´ game-logic.js ‰∏≠ÁöÑÂáΩÂºè
    // ‰æãÂ¶Ç: cultivateBtn.onclick = () => GameLogic.openCultivationSetupModalLogic(monster.id);
    console.log("UI: Farm list populated.");
}

export function updateFarmMonsterStatusDisplay(monster, statusDivElement) {
    // ... (Ê†πÊìöÊÄ™Áç∏ÁöÑ farmStatus Êõ¥Êñ∞ÂÖ∂Âú®Ëæ≤Â†¥ÂàóË°®‰∏≠ÁöÑÁãÄÊÖãÈ°ØÁ§∫) ...
    console.log(`UI: Farm monster status display updated for ${monster.nickname}.`);
}

// --- ‰øÆÁÖâ UI ---
export function renderTrainingItems() {
    // ... (Âú®‰øÆÁÖâÊàêÊûúÂΩàÁ™ó‰∏≠Ê∏≤ÊüìÊãæÁç≤ÁöÑÁâ©ÂìÅÂàóË°®) ...
    // ÊØèÂÄãÁâ©ÂìÅÁöÑ "Âä†ÂÖ•ËÉåÂåÖ" ÊåâÈàïÊáâËß∏Áôº GameLogic.addToTemporaryBackpackLogic
    console.log("UI: Training items rendered.");
}

export function updateTrainingItemsDisplay() { // Áî®ÊñºÂú®ÈªûÊìä"Âä†ÂÖ•ËÉåÂåÖ"ÂæåÊõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
    // const { trainingItemsResult } = GameState.elements;
    // GameState.itemsFromCurrentTraining.forEach((item, index) => {
    //     const btn = trainingItemsResult?.querySelector(`.add-one-to-temp-backpack-btn[data-item-index="${index}"]`);
    //     if (btn && item.addedToBackpack) {
    //         btn.textContent = 'Â∑≤Âä†ÂÖ•';
    //         btn.disabled = true;
    //     }
    // });
    console.log("UI: Training items display (button states) updated.");
}


// --- ÊéíË°åÊ¶ú UI ---
export function setupMonsterLeaderboardTabs() {
    // ... (ÂâµÂª∫ÊÄ™Áç∏ÊéíË°åÊ¶úÁöÑÂÖÉÁ¥†È†ÅÁ±§ÊåâÈàï) ...
    // ÊØèÂÄãÈ†ÅÁ±§ÊåâÈàïÁöÑÈªûÊìä‰∫ã‰ª∂ÊáâËß∏Áôº populateMonsterLeaderboard
    console.log("UI: Monster leaderboard tabs setup.");
}
export function populateMonsterLeaderboard(filterElement = 'ÊâÄÊúâ') {
    // ... (Áç≤ÂèñÊéíÂ∫èÂæåÁöÑÊÄ™Áç∏Ë≥áÊñô - ÂèØËÉΩ‰æÜËá™ game-logic.jsÔºåÁÑ∂ÂæåÊ∏≤ÊüìÂà∞Ë°®Ê†º) ...
    // "ÊåëÊà∞" ÊåâÈàïÊáâËß∏Áôº GameLogic.promptChallengeMonsterLogic
    console.log(`UI: Monster leaderboard populated for element: ${filterElement}`);
}
export function populatePlayerLeaderboard() {
    // ... (Áç≤ÂèñÊéíÂ∫èÂæåÁöÑÁé©ÂÆ∂Ë≥áÊñô - ÂèØËÉΩ‰æÜËá™ game-logic.jsÔºåÁÑ∂ÂæåÊ∏≤ÊüìÂà∞Ë°®Ê†º) ...
    console.log("UI: Player leaderboard populated.");
}

// --- ÂÖ∂‰ªñ UI ---
export function populateNewbieGuide(searchTerm = "") {
    // ... (Ê†πÊìöÊêúÂ∞ãË©ûÈÅéÊøæ GameState.newbieGuideData ‰∏¶Ê∏≤ÊüìÂà∞Êñ∞ÊâãÊåáÂçóÂΩàÁ™ó) ...
    console.log(`UI: Newbie guide populated/filtered with term: "${searchTerm}".`);
}

export function displaySearchedPlayers(playersToDisplay) {
    // ... (Âú®Â•ΩÂèãÂàóË°®ÂΩàÁ™ó‰∏≠È°ØÁ§∫ÊêúÂ∞ãÂà∞ÁöÑÁé©ÂÆ∂ÂàóË°®) ...
    // ÊØèÂÄãÁé©ÂÆ∂È†ÖÁõÆÁöÑÈªûÊìä‰∫ã‰ª∂ÊáâËß∏Áôº GameLogic.showPlayerInfoPopupLogic
    console.log("UI: Searched players displayed.");
}
export function updateFriendsListContainerWithMessage(message, isError = false) {
    // const { friendsListContainer } = GameState.elements;
    // if (friendsListContainer) {
    //     friendsListContainer.innerHTML = `<p class="text-center text-base ${isError ? 'text-[var(--danger-color)]' : 'text-[var(--text-secondary)]'}">${message}</p>`;
    // }
    console.log(`UI: Friends list container message updated: "${message}", isError: ${isError}`);
}


export function openAndPopulatePlayerInfoModal(playerGameData, targetPlayerUid) {
    // ... (Ê∏≤ÊüìÁé©ÂÆ∂Ë©≥Á¥∞Ë≥áË®äÂà∞Áé©ÂÆ∂Ë≥áË®äÂΩàÁ™ó) ...
    // openModal('player-info-modal');
    console.log(`UI: Player info modal populated and opened for UID: ${targetPlayerUid}.`);
}

export function displayBattleLog(logEntries) {
    // ... (Â∞áÊà∞È¨•Êó•Ë™åÊ¢ùÁõÆÊ∏≤ÊüìÂà∞Êà∞È¨•Êó•Ë™åÂΩàÁ™ó) ...
    // openModal('battle-log-modal');
    console.log("UI: Battle log displayed.");
}

export function renderDnaDrawResults(drawnDnaForModal) {
    // const { dnaDrawResultsGrid } = GameState.elements;
    // if (!dnaDrawResultsGrid) return;
    // dnaDrawResultsGrid.innerHTML = '';
    // if (drawnDnaForModal.length > 0) {
    //     drawnDnaForModal.forEach(dna => {
    //         const itemDiv = document.createElement('div');
    //         itemDiv.className = 'dna-draw-result-item';
    //         // ... Ê∏≤Êüì DNA È†ÖÁõÆ HTML ...
    //         const addButton = itemDiv.querySelector('.add-drawn-to-temp-backpack-btn');
    //         if (addButton) {
    //             addButton.onclick = (e) => {
    //                 const dnaToAdd = JSON.parse(e.target.dataset.dna);
    //                 GameLogic.addToTemporaryBackpackLogic(dnaToAdd); // ÂëºÂè´ game-logic
    //                 e.target.textContent = 'Â∑≤Âä†ÂÖ•';
    //                 e.target.disabled = true;
    //             };
    //         }
    //         dnaDrawResultsGrid.appendChild(itemDiv);
    //     });
    // } else {
    //     dnaDrawResultsGrid.innerHTML = '<p>Êú™ËÉΩÊäΩÂà∞‰ªª‰ΩïDNA...</p>';
    // }
    console.log("UI: DNA draw results rendered.");
}


export function showAuthScreen() {
    // GameState.elements.authScreen.style.display = 'flex';
    // GameState.elements.gameContainer.style.display = 'none';
    // closeAllModals(); // Á¢∫‰øùÊâÄÊúâÂΩàÁ™óÈóúÈñâ
    console.log("UI: Auth screen shown.");
}

export function showGameScreenAfterLogin() {
    // GameState.elements.authScreen.style.display = 'none';
    // GameState.elements.gameContainer.style.display = 'flex';
    // GameState.elements.gameContainer.style.flexDirection = 'column';
    // GameState.elements.gameContainer.style.alignItems = 'center';
    console.log("UI: Game screen shown after login.");
}

export function initializeInventoryDisplay() { // ÈÄôÂÄãÂáΩÂºèÂçîË™øÂÖ∂‰ªñ UI ÂáΩÂºè
    // GameLogic.initializeInventoryDisplayLogic(); // ÂëºÂè´ game-logic ÂàùÂßãÂåñË≥áÊñô
    // populateInventory();
    // populateTemporaryBackpack();
    console.log("UI: Inventory display initialized (called populate functions).");
}

export function updateMonsterInfoButtonState(currentMonster) {
    // const { monsterInfoButton } = GameState.elements;
    // if (monsterInfoButton) {
    //     monsterInfoButton.disabled = !currentMonster;
    //     if (currentMonster) {
    //         monsterInfoButton.onclick = () => {
    //             updateMonsterInfoModal(currentMonster); // ÂëºÂè´Êú¨Ê™îÊ°àÁöÑÂáΩÂºè
    //             openModal('monster-info-modal');
    //         };
    //     } else {
    //         monsterInfoButton.onclick = null;
    //     }
    // }
    console.log("UI: Monster info button state updated.");
}

export function updateActionButtonsStateUI() { // Á¥î UI ÈÉ®ÂàÜÁöÑÊåâÈàïÁãÄÊÖãÊõ¥Êñ∞
    const { combineButton, monsterInfoButton } = GameState.elements;
    if (combineButton) {
        const hasItemsInCombination = GameState.combinationSlotsData.some(s => s !== null);
        combineButton.disabled = !hasItemsInCombination;
    }
    if (monsterInfoButton) {
         const isAnyMonsterBattling = GameState.farmedMonsters.some(m => m.farmStatus && m.farmStatus.isBattling);
         const monsterForInfo = isAnyMonsterBattling ? (GameState.battlingMonsterId ? GameState.farmedMonsters.find(m => m.id === GameState.battlingMonsterId) : GameState.currentMonster) : GameState.currentMonster; // ‰øÆÊ≠£ÔºöÂç≥‰ΩøÁÑ°Âá∫Êà∞‰πüÂèØËÉΩÈ°ØÁ§∫Áï∂ÂâçÊÄ™Áç∏
         monsterInfoButton.disabled = !monsterForInfo;
    }
    console.log("UI: Action buttons state updated.");
}

// ÂÅáË®≠ GameState Âíå ApiClient Â∑≤Âú®ÊüêËôïÂÆöÁæ©‰∏¶Â°´ÂÖÖ
// ÈÄôÊòØÁÇ∫‰∫ÜËÆìÊ≠§Ê™îÊ°à‰∏≠ÁöÑÂáΩÂºèËÉΩÂ§†Ë¢´ÈùúÊÖãÂàÜÊûêÂô®ÊàñÊÇ®Ëá™Â∑±Êõ¥ÂÆπÊòìÁêÜËß£ÂÖ∂‰æùË≥¥
const GameState = {
    elements: { /* ... DOM element references ... */ },
    gameSettings: { dnaFragments: [], rarities: {}, skills: {}, personalities: [], titles: [], healthConditions: [], newbieGuide: [], value_settings: { max_farm_slots: 10, max_monster_skills: 3 } },
    playerOwnedDNA: [],
    temporaryBackpackSlots: new Array(18).fill(null),
    inventoryDisplaySlots: new Array(10).fill(null),
    combinationSlotsData: new Array(5).fill(null),
    itemToDeleteInfo: null,
    currentLoggedInUser: null,
    farmedMonsters: [],
    MAX_FARM_SLOTS: 10,
    NUM_TEMP_BACKPACK_SLOTS: 18,
    NUM_INVENTORY_SLOTS: 10,
    NUM_COMBINATION_SLOTS: 5,
    currentMonster: null,
    battlingMonsterId: null,
    playerStats: { achievements: [] },
    itemsFromCurrentTraining: [],
    monsterToReleaseInfo: null,
    monsterToChallengeInfo: null,
    currentCultivationMonster: null,
    MAX_CULTIVATION_SECONDS: 999,
    newbieGuideData: [],
};

// ÈÄô‰∫õÂáΩÂºèÊòØ game-logic.js ‰∏≠ÁöÑÔºåUI ‰∫ã‰ª∂ËôïÁêÜÂô®ÂèØËÉΩÊúÉÂëºÂè´ÂÆÉÂÄë
const GameLogic = {
    // handleDragStart: (e) => console.log("GL: Drag Start", e),
    // handleDrop: (e) => console.log("GL: Drop", e),
    // handleDropOnDeleteSlotLogic: (e) => console.log("GL: Drop on Delete", e),
    // handleDragOver: (e) => e.preventDefault(),
    // handleDragLeave: (e) => {},
    // handleComboSlotClickLogic: (e) => console.log("GL: Combo Slot Click", e),
    // moveFromTempToInventoryLogic: (index) => console.log("GL: Move from temp to inv", index),
    // handleDrawDnaButtonClickLogic: () => console.log("GL: Draw DNA Button Click"),
    // openCultivationSetupModalLogic: (id) => console.log("GL: Open Cultivation", id),
    // promptChallengeMonsterLogic: (monster) => console.log("GL: Prompt Challenge", monster),
    // showPlayerInfoPopupLogic: (uid) => console.log("GL: Show Player Popup", uid),
    // getRarityData: (rarityName) => ({ textVarKey: '--rarity-common-text'}), // Á∞°Âåñ
};
